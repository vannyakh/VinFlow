{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Backup Codes" %} - VinFlow{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-6">
    <h1 class="text-3xl font-bold">{% trans "Backup Codes" %}</h1>
    
    <div class="card-glass rounded-xl p-6">
        <div class="space-y-4">
            <div class="p-4 bg-yellow-900/20 border border-yellow-500/30 rounded-lg">
                <h3 class="font-semibold text-yellow-400 mb-2">{% trans "Important: Save Your Backup Codes" %}</h3>
                <p class="text-sm text-gray-400">
                    {% trans "These codes can be used to access your account if you lose your authenticator device. Each code can only be used once. Store them in a safe place." %}
                </p>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                {% for code in backup_codes %}
                    <div class="bg-slate-800 p-4 rounded font-mono text-center text-lg font-semibold border border-slate-700">
                        {{ code }}
                    </div>
                {% endfor %}
            </div>
            
            <div class="flex flex-wrap gap-3 pt-4 border-t border-slate-700">
                <button onclick="printBackupCodes()" class="btn-primary btn">
                    {% trans "Print Codes" %}
                </button>
                <button onclick="downloadBackupCodes()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition">
                    {% trans "Download as Text" %}
                </button>
                <a href="{% url 'profile' %}" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition">
                    {% trans "Back to Profile" %}
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function printBackupCodes() {
    const codes = [{% for code in backup_codes %}'{{ code }}'{% if not forloop.last %},{% endif %}{% endfor %}];
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
            <head>
                <title>{% trans "Backup Codes - VinFlow" %}</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    h1 { color: #8b5cf6; }
                    .codes { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; }
                    .code { padding: 10px; border: 1px solid #ccc; text-align: center; font-family: monospace; font-size: 16px; }
                    .warning { background: #fef3c7; padding: 15px; border-radius: 5px; margin: 20px 0; }
                </style>
            </head>
            <body>
                <h1>{% trans "VinFlow Backup Codes" %}</h1>
                <p>{% trans "Store these codes in a safe place. Each code can only be used once." %}</p>
                <div class="codes">
                    ${codes.map(code => `<div class="code">${code}</div>`).join('')}
                </div>
                <div class="warning">
                    <strong>{% trans "Important:" %}</strong> {% trans "If you lose access to your authenticator app, use these codes to access your account. Keep them secure!" %}
                </div>
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

function downloadBackupCodes() {
    const codes = [{% for code in backup_codes %}'{{ code }}'{% if not forloop.last %},{% endif %}{% endfor %}];
    const content = `VinFlow Backup Codes\n\n` +
        `Store these codes in a safe place. Each code can only be used once.\n\n` +
        codes.join('\n') +
        `\n\nImportant: If you lose access to your authenticator app, use these codes to access your account. Keep them secure!`;
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'vinflow-backup-codes.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
{% endblock %}

