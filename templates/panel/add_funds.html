{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Add Funds" %} - VinFlow{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-4 md:space-y-6 px-4 md:px-0 py-4 md:py-0">
    <h1 class="text-2xl md:text-3xl font-bold">{% trans "Add Funds" %}</h1>
    
    <!-- Promotions Banner -->
    {% include 'panel/partials/promotion_banner.html' with location='checkout' %}
    
    <!-- Current Balance Card -->
    <div class="card-glass rounded-xl p-4 md:p-6 gradient-purple">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-purple-100 text-xs md:text-sm mb-1">{% trans "Current Balance" %}</p>
                <p class="text-2xl md:text-3xl font-bold text-white">${{ user.profile.balance|floatformat:2 }}</p>
            </div>
            <div class="w-12 h-12 md:w-16 md:h-16 bg-white/20 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- Add Funds Form -->
    <div class="card-glass rounded-xl p-4 md:p-6">
        <h2 class="text-lg md:text-xl font-bold mb-4">{% trans "Payment Information" %}</h2>
        
        <form method="post" class="space-y-4 md:space-y-6">
            {% csrf_token %}
            
            <!-- Amount -->
            <div>
                <label for="amount" class="block text-sm font-medium mb-2">
                    {% trans "Amount" %} <span class="text-red-400">*</span>
                </label>
                <div class="relative">
                    <span class="absolute left-3 md:left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg">$</span>
                    <input 
                        type="number" 
                        id="amount" 
                        name="amount" 
                        step="0.01" 
                        min="{{ min_deposit }}" 
                        max="{{ max_deposit }}" 
                        required
                        placeholder="0.00"
                        class="w-full bg-slate-700 border border-slate-600 rounded-lg pl-7 md:pl-8 pr-4 py-3 md:py-3.5 text-base md:text-base focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20"
                        inputmode="decimal"
                    >
                </div>
                <p class="text-xs text-gray-400 mt-1.5">
                    {% trans "Minimum:" %} ${{ min_deposit|floatformat:2 }} | {% trans "Maximum:" %} ${{ max_deposit|floatformat:2 }}
                </p>
            </div>
            
            <!-- Payment Method -->
            <div>
                <label for="method" class="block text-sm font-medium mb-2">
                    {% trans "Payment Method" %} <span class="text-red-400">*</span>
                </label>
                
                <!-- Payment Methods Grid -->
                <div class="grid grid-cols-1 gap-3 mb-3">
                    {% for method_code, method_name in payment_methods %}
                        {% if method_code == 'paypal' %}
                        <label class="relative flex items-center p-4 md:p-4 bg-slate-700 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-purple-500 active:bg-slate-600 transition has-checked:border-purple-500 has-checked:bg-purple-900/20 min-h-[64px]">
                            <input type="radio" name="method" value="paypal" class="sr-only peer" required>
                            <div class="flex items-center space-x-3 flex-1">
                                <div class="shrink-0">
                                    <svg class="w-10 h-10 md:w-8 md:h-8 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.174 1.351 1.05 3.3.93 4.855-.021.24-.042.48-.062.72-.077.857-.155 1.714-.211 2.529-.23 3.339-.313 4.653-.313 5.192 0 .577-.192 1.11-.573 1.54a3.3 3.3 0 0 1-2.29 1.01c-.26.01-.52.02-.78.02h-3.93c-.63 0-1.19.39-1.42.97l-1.75 3.99a2.11 2.11 0 0 1-1.9 1.23H9.23a1.08 1.08 0 0 1-1.08-1.08v-.01a1.08 1.08 0 0 1 1.08-1.08h1.75c.28 0 .53-.16.66-.41l1.85-4.2a.77.77 0 0 0-.69-1.06H8.05c-.63 0-1.19.39-1.42.97l-1.75 3.99a2.11 2.11 0 0 1-1.9 1.23H2.47z"/>
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-base">PayPal</div>
                                    <div class="text-xs text-gray-400">{% trans "Secure payment" %}</div>
                                </div>
                            </div>
                            <svg class="w-6 h-6 md:w-5 md:h-5 text-purple-500 opacity-0 peer-checked:opacity-100 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </label>
                        {% elif method_code == 'stripe' %}
                        <label class="relative flex items-center p-4 md:p-4 bg-slate-700 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-purple-500 active:bg-slate-600 transition has-checked:border-purple-500 has-checked:bg-purple-900/20 min-h-[64px]">
                            <input type="radio" name="method" value="stripe" class="sr-only peer" required>
                            <div class="flex items-center space-x-3 flex-1">
                                <div class="shrink-0">
                                    <svg class="w-10 h-10 md:w-8 md:h-8 text-indigo-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.857-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-base">Stripe</div>
                                    <div class="text-xs text-gray-400">{% trans "Credit/Debit card" %}</div>
                                </div>
                            </div>
                            <svg class="w-6 h-6 md:w-5 md:h-5 text-purple-500 opacity-0 peer-checked:opacity-100 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </label>
                        {% elif method_code == 'khqr' %}
                        <label class="relative flex items-center p-4 md:p-4 bg-slate-700 border-2 border-slate-600 rounded-lg cursor-pointer hover:border-purple-500 active:bg-slate-600 transition has-checked:border-purple-500 has-checked:bg-purple-900/20 min-h-[64px]">
                            <input type="radio" name="method" value="khqr" class="sr-only peer" required>
                            <div class="flex items-center space-x-3 flex-1">
                                <div class="shrink-0">
                                    <svg class="w-10 h-10 md:w-8 md:h-8 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8zM5 5v4h4V5H5zm10 0v4h4V5h-4zM5 15v4h4v-4H5zm10 0v4h4v-4h-4z"/>
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-base">KHQR Bakong</div>
                                    <div class="text-xs text-gray-400">{% trans "QR payment" %}</div>
                                </div>
                            </div>
                            <svg class="w-6 h-6 md:w-5 md:h-5 text-purple-500 opacity-0 peer-checked:opacity-100 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </label>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <p class="text-xs text-gray-400 mt-2">
                    {% trans "All payment methods are secure. Your payment information is encrypted and secure." %}
                </p>
            </div>
            
            <!-- Quick Amount Buttons -->
            <div>
                <label class="block text-sm font-medium mb-2">{% trans "Quick Select" %}</label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-2">
                    <button 
                        type="button" 
                        onclick="setAmount(10)" 
                        class="px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-sm md:text-sm font-medium transition touch-manipulation"
                    >
                        $10
                    </button>
                    <button 
                        type="button" 
                        onclick="setAmount(25)" 
                        class="px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-sm md:text-sm font-medium transition touch-manipulation"
                    >
                        $25
                    </button>
                    <button 
                        type="button" 
                        onclick="setAmount(50)" 
                        class="px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-sm md:text-sm font-medium transition touch-manipulation"
                    >
                        $50
                    </button>
                    <button 
                        type="button" 
                        onclick="setAmount(100)" 
                        class="px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-sm md:text-sm font-medium transition touch-manipulation"
                    >
                        $100
                    </button>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="pt-4 md:pt-4 border-t border-slate-700">
                <button type="submit" class="btn-primary w-full py-3.5 md:py-3 text-base md:text-base font-semibold touch-manipulation">
                    {% trans "Proceed to Payment" %}
                </button>
            </div>
        </form>
    </div>
    
    <!-- Information Card -->
    <div class="card-glass rounded-xl p-4 md:p-6 bg-blue-900/20 border border-blue-500/30">
        <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-blue-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <h3 class="font-semibold text-blue-400 mb-1 text-sm md:text-base">{% trans "Payment Information" %}</h3>
                <p class="text-xs md:text-sm text-gray-300 leading-relaxed">
                    {% trans "After submitting this form, you will be redirected to complete your payment. Once the payment is confirmed, funds will be automatically added to your account balance." %}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Quick Links -->
    <div class="flex flex-col sm:flex-row gap-3 md:gap-4 pb-4">
        <a href="{% url 'transaction_logs' %}" class="flex-1 px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-center text-sm md:text-base transition touch-manipulation">
            {% trans "View Transaction Logs" %}
        </a>
        <a href="{% url 'dashboard' %}" class="flex-1 px-4 py-3 md:py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-center text-sm md:text-base transition touch-manipulation">
            {% trans "Back to Dashboard" %}
        </a>
    </div>
</div>

<script>
function setAmount(amount) {
    document.getElementById('amount').value = amount;
}
</script>
{% endblock %}

