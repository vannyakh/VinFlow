{% extends 'panel/admin/base.html' %}
{% load i18n %}

{% block title %}{% trans "Services Management" %} - VinFlow{% endblock %}

{% block admin_content %}
<div class="space-y-6">
    <h1 class="text-3xl font-bold">{% trans "Services Management" %}</h1>
    
    <!-- Search and Filters -->
    <div class="card-glass rounded-xl p-4">
        <form method="get" class="space-y-4">
            <div class="flex gap-4 flex-wrap">
                <input type="text" name="search" value="{{ search }}" placeholder="{% trans 'Search services...' %}" class="flex-1 min-w-[200px] bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                <select name="social_network" class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    <option value="">{% trans "All Platforms" %}</option>
                    {% for network in social_networks %}
                    <option value="{{ network.id }}" {% if social_network_filter == network.id|stringformat:"s" %}selected{% endif %}>
                        {{ network.name }}
                    </option>
                    {% endfor %}
                </select>
                <select name="status" class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    <option value="">{% trans "All Status" %}</option>
                    <option value="active" {% if status_filter == 'active' %}selected{% endif %}>{% trans "Active" %}</option>
                    <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>{% trans "Inactive" %}</option>
                </select>
                <select name="supplier" class="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    <option value="">{% trans "All Suppliers" %}</option>
                    <option value="jap" {% if supplier_filter == 'jap' %}selected{% endif %}>JAP</option>
                    <option value="peakerr" {% if supplier_filter == 'peakerr' %}selected{% endif %}>Peakerr</option>
                    <option value="smmkings" {% if supplier_filter == 'smmkings' %}selected{% endif %}>SMMKings</option>
                </select>
                {% if per_page %}<input type="hidden" name="per_page" value="{{ per_page }}">{% endif %}
                <button type="submit" class="btn-primary">{% trans "Filter" %}</button>
                {% if search or social_network_filter or status_filter or supplier_filter %}
                <a href="{% url 'admin_services' %}{% if per_page %}?per_page={{ per_page }}{% endif %}" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">{% trans "Clear" %}</a>
                {% endif %}
            </div>
        </form>
    </div>
    
    <!-- Services Table -->
    <div class="card-glass rounded-xl p-6">
        <div class="mb-4 flex justify-between items-center flex-wrap gap-4">
            <div class="text-sm text-gray-400">
                {% trans "Showing" %} {{ services.start_index }} - {{ services.end_index }} {% trans "of" %} {{ services.paginator.count }} {% trans "services" %}
            </div>
            <form method="get" class="flex items-center gap-2">
                {% if search %}<input type="hidden" name="search" value="{{ search }}">{% endif %}
                {% if social_network_filter %}<input type="hidden" name="social_network" value="{{ social_network_filter }}">{% endif %}
                {% if status_filter %}<input type="hidden" name="status" value="{{ status_filter }}">{% endif %}
                {% if supplier_filter %}<input type="hidden" name="supplier" value="{{ supplier_filter }}">{% endif %}
                <label for="per_page" class="text-sm text-gray-400">{% trans "Items per page:" %}</label>
                <select name="per_page" id="per_page" onchange="this.form.submit()" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-1 text-sm">
                    {% for option in per_page_options %}
                    <option value="{{ option }}" {% if per_page == option %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-slate-700">
                        <th class="text-left py-3 px-4">{% trans "Platform" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Service" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Category" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Rate" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Supplier" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Status" %}</th>
                        <th class="text-left py-3 px-4">{% trans "Actions" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                    <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                        <td class="py-3 px-4">
                            {% if service.category.social_network %}
                                <div class="flex items-center gap-2">
                                    {% if service.category.social_network.icon_image %}
                                        <img src="{{ service.category.social_network.icon_image.url }}" alt="{{ service.category.social_network.name }}" class="w-6 h-6 object-contain">
                                    {% elif service.category.social_network.icon %}
                                        <i class="{{ service.category.social_network.icon }} text-lg" style="color: {{ service.category.social_network.color }}"></i>
                                    {% else %}
                                        <i class="{{ service.category.social_network.get_icon_class }} text-lg" style="color: {{ service.category.social_network.color }}"></i>
                                    {% endif %}
                                    <span class="text-sm font-medium">{{ service.category.social_network.name }}</span>
                                </div>
                            {% else %}
                                <span class="text-gray-500 text-sm">-</span>
                            {% endif %}
                        </td>
                        <td class="py-3 px-4">
                            <div class="font-medium">{{ service.name }}</div>
                            {% if service.external_service_id %}
                            <div class="text-xs text-gray-500">ID: {{ service.external_service_id }}</div>
                            {% endif %}
                        </td>
                        <td class="py-3 px-4">
                            <span class="text-sm">{{ service.category.name|default:"-" }}</span>
                        </td>
                        <td class="py-3 px-4">${{ service.rate|floatformat:4 }}/1K</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 rounded text-xs bg-slate-700 text-gray-300 uppercase">
                                {{ service.supplier_api }}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 rounded text-xs {% if service.is_active %}bg-green-900/50 text-green-400{% else %}bg-red-900/50 text-red-400{% endif %}">
                                {% if service.is_active %}{% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="service_id" value="{{ service.id }}">
                                <button type="submit" name="action" value="toggle_active" class="text-purple-400 hover:text-purple-300 text-sm">
                                    {% if service.is_active %}{% trans "Deactivate" %}{% else %}{% trans "Activate" %}{% endif %}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="py-8 text-center text-gray-400">{% trans "No services found" %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if services.has_other_pages %}
        <div class="mt-6 flex items-center justify-between flex-wrap gap-4">
            <div class="text-sm text-gray-400">
                {% trans "Page" %} {{ services.number }} {% trans "of" %} {{ services.paginator.num_pages }}
            </div>
            <div class="flex gap-2 flex-wrap">
                {% if services.has_previous %}
                <a href="?page=1{% if search %}&search={{ search|urlencode }}{% endif %}{% if social_network_filter %}&social_network={{ social_network_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if supplier_filter %}&supplier={{ supplier_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
                    {% trans "First" %}
                </a>
                <a href="?page={{ services.previous_page_number }}{% if search %}&search={{ search|urlencode }}{% endif %}{% if social_network_filter %}&social_network={{ social_network_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if supplier_filter %}&supplier={{ supplier_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
                    {% trans "Previous" %}
                </a>
                {% endif %}
                
                {% for num in services.paginator.page_range %}
                    {% if services.number == num %}
                    <span class="px-3 py-2 bg-purple-600 rounded-lg text-sm">{{ num }}</span>
                    {% elif num > services.number|add:'-3' and num < services.number|add:'3' %}
                    <a href="?page={{ num }}{% if search %}&search={{ search|urlencode }}{% endif %}{% if social_network_filter %}&social_network={{ social_network_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if supplier_filter %}&supplier={{ supplier_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
                        {{ num }}
                    </a>
                    {% endif %}
                {% endfor %}
                
                {% if services.has_next %}
                <a href="?page={{ services.next_page_number }}{% if search %}&search={{ search|urlencode }}{% endif %}{% if social_network_filter %}&social_network={{ social_network_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if supplier_filter %}&supplier={{ supplier_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
                    {% trans "Next" %}
                </a>
                <a href="?page={{ services.paginator.num_pages }}{% if search %}&search={{ search|urlencode }}{% endif %}{% if social_network_filter %}&social_network={{ social_network_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if supplier_filter %}&supplier={{ supplier_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
                    {% trans "Last" %}
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

