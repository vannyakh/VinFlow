{% extends 'panel/admin/base.html' %}
{% load i18n %}

{% block title %}{% trans "Create Promotion" %} - VinFlow{% endblock %}

{% block admin_content %}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold">{% trans "Create Marketing Promotion" %}</h1>
        <a href="{% url 'admin_promotions_list' %}" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm">
            {% trans "Back to List" %}
        </a>
    </div>
    
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <!-- Basic Information -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Basic Information" %}</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Title" %} *</label>
                    <input type="text" name="title" required 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                           placeholder="{% trans 'e.g., Flash Sale - 50% Off!' %}">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Title (Khmer)" %}</label>
                    <input type="text" name="title_km" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                           placeholder="{% trans 'e.g., ការលក់ពិសេស - បញ្ចុះតម្លៃ 50%!' %}">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Description" %}</label>
                    <textarea name="description" rows="3" 
                              class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                              placeholder="{% trans 'Promotion description...' %}"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Description (Khmer)" %}</label>
                    <textarea name="description_km" rows="3" 
                              class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                              placeholder="{% trans 'Promotion description in Khmer...' %}"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Promotion Type" %} *</label>
                        <select name="promotion_type" required 
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                            {% for type_key, type_label in promotion_types %}
                            <option value="{{ type_key }}">{{ type_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Status" %} *</label>
                        <select name="status" required 
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                            {% for status_key, status_label in status_choices %}
                            <option value="{{ status_key }}" {% if status_key == 'draft' %}selected{% endif %}>
                                {{ status_label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Visual Design -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Visual Design" %}</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Banner Image (Desktop)" %}</label>
                        <input type="file" name="banner_image" accept="image/*" 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                        <p class="text-xs text-gray-500 mt-1">{% trans "Recommended: 1200x300px" %}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Banner Image (Mobile)" %}</label>
                        <input type="file" name="banner_image_mobile" accept="image/*" 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                        <p class="text-xs text-gray-500 mt-1">{% trans "Recommended: 600x300px" %}</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Background Color" %}</label>
                        <div class="flex gap-2">
                            <input type="color" name="background_color" value="#007bff" 
                                   class="h-10 w-20 rounded-lg border border-slate-600">
                            <input type="text" name="background_color" value="#007bff" 
                                   class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                                   placeholder="#007bff">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Text Color" %}</label>
                        <div class="flex gap-2">
                            <input type="color" name="text_color" value="#ffffff" 
                                   class="h-10 w-20 rounded-lg border border-slate-600">
                            <input type="text" name="text_color" value="#ffffff" 
                                   class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                                   placeholder="#ffffff">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Targeting -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Targeting & Display" %}</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Target Audience" %} *</label>
                        <select name="target_audience" required 
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                            {% for audience_key, audience_label in target_audience_choices %}
                            <option value="{{ audience_key }}">{{ audience_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Display Location" %} *</label>
                        <select name="display_location" required 
                                class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                            {% for location_key, location_label in display_location_choices %}
                            <option value="{{ location_key }}">{{ location_label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Display Priority" %}</label>
                    <input type="number" name="display_priority" value="0" min="0" max="100" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    <p class="text-xs text-gray-500 mt-1">{% trans "Higher number = higher priority (shown first)" %}</p>
                </div>
            </div>
        </div>
        
        <!-- Schedule -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Schedule" %}</h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Start Date & Time" %} *</label>
                        <input type="datetime-local" name="start_date" required 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "End Date & Time" %} *</label>
                        <input type="datetime-local" name="end_date" required 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Call to Action -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Call to Action" %}</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Button Text" %}</label>
                    <input type="text" name="cta_text" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                           placeholder="{% trans 'e.g., Shop Now, Get Started, Learn More' %}">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Button Link" %}</label>
                    <input type="text" name="cta_link" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                           placeholder="{% trans 'e.g., /services/, /add-funds/' %}">
                </div>
            </div>
        </div>
        
        <!-- Offer Details -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Offer Details" %}</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Discount Code" %}</label>
                    <input type="text" name="discount_code" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                           placeholder="{% trans 'e.g., FLASH50' %}">
                    <p class="text-xs text-gray-500 mt-1">{% trans "Link to an existing coupon code" %}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Discount Percentage" %}</label>
                        <input type="number" name="discount_percentage" value="0" min="0" max="100" step="0.01" 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">{% trans "Bonus Amount" %}</label>
                        <input type="number" name="bonus_amount" value="0" min="0" step="0.01" 
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                        <p class="text-xs text-gray-500 mt-1">{% trans "Free balance bonus amount" %}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings -->
        <div class="card-glass rounded-xl p-6">
            <h2 class="text-xl font-bold mb-4 text-purple-400">{% trans "Settings" %}</h2>
            <div class="space-y-4">
                <div class="flex items-center space-x-3">
                    <label class="toggle-switch">
                        <input type="checkbox" name="auto_expire" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div>
                        <label class="text-sm font-medium">{% trans "Auto Expire" %}</label>
                        <p class="text-xs text-gray-500">{% trans "Automatically expire after end date" %}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <label class="toggle-switch">
                        <input type="checkbox" name="show_countdown">
                        <span class="toggle-slider"></span>
                    </label>
                    <div>
                        <label class="text-sm font-medium">{% trans "Show Countdown Timer" %}</label>
                        <p class="text-xs text-gray-500">{% trans "Display countdown timer on promotion" %}</p>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">{% trans "Max Views Per User" %}</label>
                    <input type="number" name="max_views_per_user" value="0" min="0" 
                           class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2">
                    <p class="text-xs text-gray-500 mt-1">{% trans "0 = unlimited views" %}</p>
                </div>
            </div>
        </div>
        
        <!-- Submit Buttons -->
        <div class="flex gap-4">
            <button type="submit" class="btn-primary">
                {% trans "Create Promotion" %}
            </button>
            <a href="{% url 'admin_promotions_list' %}" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg">
                {% trans "Cancel" %}
            </a>
        </div>
    </form>
</div>
{% endblock %}

