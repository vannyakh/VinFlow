{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Transaction Logs" %} - VinFlow{% endblock %}

{% block content %}
<div class="space-y-4 md:space-y-6 px-4 md:px-0 py-4 md:py-0">
    <div class="flex items-center justify-between gap-3">
        <h1 class="text-2xl md:text-3xl font-bold">{% trans "Transaction Logs" %}</h1>
        <a href="{% url 'add_funds' %}" class="btn-primary px-4 py-2 md:px-6 md:py-3 text-sm md:text-base touch-manipulation whitespace-nowrap">
            {% trans "Add Funds" %}
        </a>
    </div>
    
    <!-- Current Balance Card -->
    <div class="card-glass rounded-xl p-4 md:p-6 gradient-purple">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-purple-100 text-xs md:text-sm mb-1">{% trans "Current Balance" %}</p>
                <p class="text-2xl md:text-3xl font-bold text-white">${{ user.profile.balance|floatformat:2 }}</p>
            </div>
            <div class="w-12 h-12 md:w-16 md:h-16 bg-white/20 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Summary Stats -->
    {% if transactions %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
        <div class="card-glass rounded-xl p-4 md:p-6">
            <div class="flex items-center justify-between">
                <div class="flex-1 min-w-0">
                    <p class="text-gray-400 text-xs md:text-sm">{% trans "Total Transactions" %}</p>
                    <p class="text-xl md:text-2xl font-bold text-cyan-400 truncate">{% if transactions.paginator %}{{ transactions.paginator.count }}{% else %}{{ transactions|length }}{% endif %}</p>
                </div>
                <div class="w-10 h-10 md:w-12 md:h-12 gradient-cyan rounded-lg flex items-center justify-center shrink-0 ml-3">
                    <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="card-glass rounded-xl p-4 md:p-6">
            <div class="flex items-center justify-between">
                <div class="flex-1 min-w-0">
                    <p class="text-gray-400 text-xs md:text-sm">{% trans "Total Deposited" %}</p>
                    <p class="text-xl md:text-2xl font-bold text-green-400 truncate">${{ total_deposited|floatformat:2 }}</p>
                </div>
                <div class="w-10 h-10 md:w-12 md:h-12 bg-green-600 rounded-lg flex items-center justify-center shrink-0 ml-3">
                    <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="card-glass rounded-xl p-4 md:p-6">
            <div class="flex items-center justify-between">
                <div class="flex-1 min-w-0">
                    <p class="text-gray-400 text-xs md:text-sm">{% trans "Pending Payments" %}</p>
                    <p class="text-xl md:text-2xl font-bold text-yellow-400 truncate">{{ pending_count }}</p>
                </div>
                <div class="w-10 h-10 md:w-12 md:h-12 bg-yellow-600 rounded-lg flex items-center justify-center shrink-0 ml-3">
                    <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Filters -->
    <div class="card-glass rounded-xl p-3 md:p-4">
        <div class="flex gap-2 flex-wrap">
            <a href="{% url 'transaction_logs' %}{% if per_page %}?per_page={{ per_page }}{% endif %}" class="px-3 md:px-4 py-2.5 md:py-2 rounded-lg {% if not status_filter %}bg-purple-600{% else %}bg-slate-700 hover:bg-slate-600 active:bg-slate-500{% endif %} text-xs md:text-sm font-medium transition touch-manipulation">
                {% trans "All" %}
            </a>
            <a href="?status=completed{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 md:px-4 py-2.5 md:py-2 rounded-lg {% if status_filter == 'completed' %}bg-purple-600{% else %}bg-slate-700 hover:bg-slate-600 active:bg-slate-500{% endif %} text-xs md:text-sm font-medium transition touch-manipulation">
                {% trans "Completed" %}
            </a>
            <a href="?status=pending{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 md:px-4 py-2.5 md:py-2 rounded-lg {% if status_filter == 'pending' %}bg-purple-600{% else %}bg-slate-700 hover:bg-slate-600 active:bg-slate-500{% endif %} text-xs md:text-sm font-medium transition touch-manipulation">
                {% trans "Pending" %}
            </a>
            <a href="?status=failed{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 md:px-4 py-2.5 md:py-2 rounded-lg {% if status_filter == 'failed' %}bg-purple-600{% else %}bg-slate-700 hover:bg-slate-600 active:bg-slate-500{% endif %} text-xs md:text-sm font-medium transition touch-manipulation">
                {% trans "Failed" %}
            </a>
            <a href="?status=canceled{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-3 md:px-4 py-2.5 md:py-2 rounded-lg {% if status_filter == 'canceled' %}bg-purple-600{% else %}bg-slate-700 hover:bg-slate-600 active:bg-slate-500{% endif %} text-xs md:text-sm font-medium transition touch-manipulation">
                {% trans "Canceled" %}
            </a>
        </div>
    </div>
    
    <!-- Transactions Table -->
    <div class="card-glass rounded-xl p-3 md:p-6">
        <div class="overflow-x-auto -mx-3 md:mx-0">
            <div class="inline-block min-w-full align-middle">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="text-left py-2 md:py-3 px-2 md:px-4 text-gray-400 text-xs md:text-sm font-medium whitespace-nowrap">{% trans "Transaction ID" %}</th>
                            <th class="text-left py-2 md:py-3 px-2 md:px-4 text-gray-400 text-xs md:text-sm font-medium whitespace-nowrap">{% trans "Amount" %}</th>
                            <th class="text-left py-2 md:py-3 px-2 md:px-4 text-gray-400 text-xs md:text-sm font-medium whitespace-nowrap">{% trans "Method" %}</th>
                            <th class="text-left py-2 md:py-3 px-2 md:px-4 text-gray-400 text-xs md:text-sm font-medium whitespace-nowrap">{% trans "Status" %}</th>
                            <th class="text-left py-2 md:py-3 px-2 md:px-4 text-gray-400 text-xs md:text-sm font-medium whitespace-nowrap">{% trans "Date" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr class="border-b border-slate-800 hover:bg-slate-800/50 active:bg-slate-800/70 transition">
                            <td class="py-2.5 md:py-3 px-2 md:px-4">
                                <span class="font-mono text-xs md:text-sm text-gray-300">{{ transaction.transaction_id }}</span>
                            </td>
                            <td class="py-2.5 md:py-3 px-2 md:px-4">
                                <span class="font-semibold text-cyan-400 text-sm md:text-base whitespace-nowrap">${{ transaction.amount|floatformat:2 }}</span>
                            </td>
                            <td class="py-2.5 md:py-3 px-2 md:px-4">
                                <span class="text-gray-300 text-xs md:text-sm">{{ transaction.get_method_display }}</span>
                            </td>
                            <td class="py-2.5 md:py-3 px-2 md:px-4">
                                <span class="px-2 py-1 rounded text-xs font-semibold whitespace-nowrap
                                    {% if transaction.status == 'completed' %}bg-green-900/50 text-green-400
                                    {% elif transaction.status == 'pending' %}bg-yellow-900/50 text-yellow-400
                                    {% elif transaction.status == 'failed' %}bg-red-900/50 text-red-400
                                    {% else %}bg-gray-900/50 text-gray-400{% endif %}">
                                    {{ transaction.get_status_display }}
                                </span>
                            </td>
                            <td class="py-2.5 md:py-3 px-2 md:px-4 text-xs md:text-sm text-gray-400 whitespace-nowrap">
                                {{ transaction.created_at|date:"M d, Y H:i" }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="py-8 md:py-12 text-center px-4">
                                <div class="flex flex-col items-center justify-center space-y-2 md:space-y-3">
                                    <svg class="w-12 h-12 md:w-16 md:h-16 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-gray-400 text-base md:text-lg">{% trans "No transactions found" %}</p>
                                    <a href="{% url 'add_funds' %}" class="text-purple-400 hover:text-purple-300 active:text-purple-200 text-sm transition">
                                        {% trans "Add funds to get started" %}
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Pagination -->
        {% if transactions.has_other_pages %}
        <div class="mt-4 md:mt-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-3 md:gap-4 px-3 md:px-0">
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 md:gap-4 w-full md:w-auto">
                <div class="text-xs md:text-sm text-gray-400">
                    {% trans "Page" %} {{ transactions.number }} {% trans "of" %} {{ transactions.paginator.num_pages }}
                </div>
                {% if per_page_options %}
                <div class="flex items-center gap-2">
                    <span class="text-xs md:text-sm text-gray-400 whitespace-nowrap">{% trans "Per page" %}:</span>
                    <select onchange="window.location.href='?{% if status_filter %}status={{ status_filter }}&{% endif %}per_page=' + this.value" class="px-2 md:px-3 py-1.5 md:py-1 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs md:text-sm text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-purple-500/20 touch-manipulation">
                        {% for option in per_page_options %}
                        <option value="{{ option }}" {% if per_page == option %}selected{% endif %}>{{ option }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
            </div>
            <div class="flex gap-1.5 md:gap-2 flex-wrap w-full md:w-auto justify-center md:justify-end">
                {% if transactions.has_previous %}
                <a href="?page=1{% if status_filter %}&status={{ status_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-2.5 md:px-3 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-xs md:text-sm transition touch-manipulation">
                    {% trans "First" %}
                </a>
                <a href="?page={{ transactions.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-2.5 md:px-3 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-xs md:text-sm transition touch-manipulation">
                    {% trans "Previous" %}
                </a>
                {% endif %}
                
                {% for num in transactions.paginator.page_range %}
                    {% if transactions.number == num %}
                    <span class="px-2.5 md:px-3 py-2 bg-purple-600 rounded-lg text-xs md:text-sm font-medium">{{ num }}</span>
                    {% elif num > transactions.number|add:'-3' and num < transactions.number|add:'3' %}
                    <a href="?page={{ num }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-2.5 md:px-3 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-xs md:text-sm transition touch-manipulation">
                        {{ num }}
                    </a>
                    {% endif %}
                {% endfor %}
                
                {% if transactions.has_next %}
                <a href="?page={{ transactions.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-2.5 md:px-3 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-xs md:text-sm transition touch-manipulation">
                    {% trans "Next" %}
                </a>
                <a href="?page={{ transactions.paginator.num_pages }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}" class="px-2.5 md:px-3 py-2 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 rounded-lg text-xs md:text-sm transition touch-manipulation">
                    {% trans "Last" %}
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    
</div>
{% endblock %}

